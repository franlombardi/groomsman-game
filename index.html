<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Best Man Qualification Test</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  :root {
    /* Light wedding palette */
    --bg-page: #f7f1eb;         /* page background, light cream */
    --card-bg: #ffffff;         /* main card background */
    --card-border: #e2d7c9;     /* soft beige border */

    --text-main: #2f3b32;       /* main dark text */
    --text-muted: #7b8577;      /* soft muted text */

    --accent: #3f5e42;          /* deep olive, like RSVP button */
    --accent-soft: #6f8b73;     /* softer olive */
    --danger: #c0564a;
    --good: #3f5e42;

    --radius-xl: 20px;
    --radius-lg: 10px;
    --shadow-soft: 0 14px 30px rgba(15, 23, 42, 0.08);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    min-height: 100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: var(--bg-page);
    color: var(--text-main);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
  }

  .app {
    width: 100%;
    max-width: 430px;
    background: var(--card-bg);
    border-radius: 24px;
    border: 1px solid var(--card-border);
    box-shadow: var(--shadow-soft);
    padding: 18px 18px 20px;
    position: relative;
    overflow: hidden;
  }

  .app::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at top left, rgba(255, 255, 255, 0.65), transparent 55%),
      radial-gradient(circle at bottom right, rgba(222, 209, 193, 0.7), transparent 60%);
    pointer-events: none;
    z-index: -1;
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .title-block {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .subtitle {
    font-size: 0.68rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--accent-soft);
  }

  h1 {
    font-family: "Georgia", "Times New Roman", serif;
    font-size: 1.3rem;
    letter-spacing: 0.04em;
    font-weight: 600;
    color: var(--text-main);
  }

  .badge {
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(242, 237, 229, 0.9);
    border: 1px solid var(--card-border);
    font-size: 0.7rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: var(--text-muted);
  }

  .badge span.icon {
    font-size: 1rem;
  }

  .hud {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  .hud-pill {
    padding: 3px 10px;
    border-radius: 999px;
    background: #f4ece3;
    border: 1px solid var(--card-border);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .hud-pill span.value {
    font-weight: 600;
    color: var(--accent-soft);
  }

  .hud-pill.good span.value {
    color: var(--good);
  }

  .hud-pill.bad span.value {
    color: var(--danger);
  }

  .hint {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 10px;
  }

  .card {
    border-radius: var(--radius-xl);
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    padding: 16px 16px 14px;
    min-height: 260px;
    display: none;
    flex-direction: column;
    justify-content: space-between;
  }

  .card.active {
    display: flex;
  }

  .card-header-tag {
    font-size: 0.68rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--accent-soft);
    margin-bottom: 6px;
  }

  .card-title {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 6px;
    color: var(--text-main);
  }

  .card-body {
    font-size: 0.8rem;
    color: var(--text-muted);
    line-height: 1.5;
  }

  .card-body strong {
    color: var(--accent-soft);
    font-weight: 600;
  }

  .options {
    margin-top: 14px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .option-btn {
    width: 100%;
    padding: 11px 12px;
    border-radius: 8px;
    border: 1px solid var(--card-border);
    background: #f6f0e8;
    color: var(--text-main);
    font-size: 0.8rem;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(15, 23, 42, 0.05);
    transition:
      transform 0.06s ease,
      box-shadow 0.06s ease,
      border-color 0.06s ease,
      background 0.06s ease;
  }

  .option-btn span.label {
    flex: 1;
  }

  .option-btn span.key {
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  .option-btn:active {
    transform: translateY(1px);
    box-shadow: 0 4px 8px rgba(15, 23, 42, 0.08);
    border-color: var(--accent-soft);
  }

  /* visual feedback for answers */
  .option-btn.correct {
    border-color: var(--good);
    background: #e4f0e6;
    box-shadow: 0 6px 14px rgba(63, 94, 66, 0.12);
  }

  .option-btn.wrong {
    border-color: var(--danger);
    background: #fce9e7;
    opacity: 0.98;
  }

  .btn-row {
    margin-top: 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .btn {
    border: none;
    border-radius: 6px;
    padding: 11px 10px;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 8px 16px rgba(63, 94, 66, 0.25);
    transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.06s ease;
  }

  .btn-primary {
    background: var(--accent);
    color: #f7f4ee;
  }

  .btn-primary:active {
    transform: translateY(1px);
    box-shadow: 0 4px 10px rgba(63, 94, 66, 0.35);
  }

  .btn-secondary {
    background: transparent;
    color: var(--accent);
    border: 1px solid var(--accent);
    box-shadow: none;
  }

  .btn-secondary:active {
    transform: translateY(1px);
    box-shadow: 0 3px 8px rgba(63, 94, 66, 0.25);
  }

  .btn span.icon {
    font-size: 1rem;
  }

  .small-text {
    margin-top: 6px;
    font-size: 0.68rem;
    color: var(--text-muted);
  }

  .small-text strong {
    color: var(--accent-soft);
  }

  .score-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 3px 8px;
    border-radius: 999px;
    background: #f4ece3;
    border: 1px solid var(--card-border);
    font-size: 0.68rem;
    color: var(--text-muted);
  }

  .score-pill span.value {
    color: var(--good);
    font-weight: 600;
  }

  footer {
    margin-top: 8px;
    text-align: center;
    font-size: 0.64rem;
    color: var(--text-muted);
  }

  footer strong {
    color: var(--accent-soft);
  }

  @media (max-width: 380px) {
    .app {
      border-radius: 20px;
      padding: 14px;
    }

    .card {
      border-radius: 16px;
      padding: 14px;
    }
  }
</style>

</head>
<body>
  <div class="app">
    <header>
      <div class="title-block">
        <span class="subtitle">Mini mission</span>
        <h1>Best Man Qualification Test</h1>
      </div>
      <div class="badge">
        <span class="icon">ü§µ‚Äç‚ôÇÔ∏è</span>
        <span id="roleLabel">Wedding Squad</span>
      </div>
    </header>

    <div class="hud">
      <div class="hud-pill">
        <span>Question</span>
        <span class="value" id="hudQuestion">0 / 0</span>
      </div>
      <div class="hud-pill good">
        <span>Score</span>
        <span class="value" id="hudScore">0</span>
      </div>
    </div>

    <div class="hint">
      All you have to do is tap the option that feels most correct. No lifelines, only instinct.
    </div>

    <!-- Intro card -->
    <div id="cardIntro" class="card active">
      <div>
        <div class="card-header-tag">Briefing</div>
        <div class="card-title" id="introTitle">Welcome, my friend</div>
        <div class="card-body" id="introBody">
          This is your <strong>Best Man Qualification Test</strong>, also known as the Worst Man stress test.<br /><br />
          You will get a few quick questions about our chaos and my life choices. There is no official pass mark,
          but I will absolutely judge you silently.
        </div>
      </div>
      <div>
        <div class="btn-row">
          <button id="btnStart" class="btn btn-primary">
            <span class="icon">‚ñ∂Ô∏è</span>
            <span>Start the test</span>
          </button>
        </div>
        <div class="small-text">
          Warning: failing this quiz will not remove you from the invite list, but it might affect the amount of teasing you get.
        </div>
      </div>
    </div>

    <!-- Question card -->
    <div id="cardQuestion" class="card">
      <div>
        <div class="card-header-tag" id="questionTag">Question</div>
        <div class="card-title" id="questionTitle">Question goes here</div>
        <div class="card-body" id="questionBody">
          Pick the one that feels most correct. There is only one official answer, but vibes matter.
        </div>
        <div class="options" id="optionsContainer">
          <!-- buttons inserted here by JS -->
        </div>
      </div>
      <div class="small-text" id="questionHint">
        Tip: answer based on what you know about me, not what you think is the polite answer.
      </div>
    </div>

    <!-- Result card -->
    <div id="cardResult" class="card">
      <div>
        <div class="card-header-tag">Debrief</div>
        <div class="card-title" id="resultTitle">You survived the test</div>
        <div class="card-body" id="resultBody">
          Placeholder text for result body.
        </div>
      </div>
      <div>
        <div class="btn-row">
          <button id="btnYes1" class="btn btn-primary">
            <span class="icon">‚úÖ</span>
            <span id="btnYes1Text">Yes, obviously</span>
          </button>
          <button id="btnYes2" class="btn btn-secondary">
            <span class="icon">üî•</span>
            <span id="btnYes2Text">I was born for this</span>
          </button>
        </div>
        <div class="small-text">
          <span class="score-pill">
            <span>Test score</span>
            <span class="value" id="resultScoreText">0 / 0</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Final answer card -->
    <div id="cardFinal" class="card">
      <div>
        <div class="card-header-tag">Squad locked</div>
        <div class="card-title" id="finalTitle">You are in</div>
        <div class="card-body" id="finalBody">
          Screenshot this if you want proof, then text me so we can plan the chaos properly.
        </div>
      </div>
      <div>
        <div class="btn-row">
          <button id="btnDone" class="btn btn-primary">
            <span class="icon">üì≤</span>
            <span>Got it</span>
          </button>
        </div>
        <div class="small-text">
          You can close this tab, but the responsibility is now permanent.
        </div>
      </div>
    </div>

    <footer>
      Designed as a one time invite for the <strong>wedding squad</strong>.
    </footer>
  </div>

  <script>
    /*
      Structure: Single-file SPA with four cards (Intro, Question, Result, Final).
      - Reads `name` and `role` from URL params.
      - Chooses a per-person question set (named sets or seeded shuffle).
      - Shows questions one at a time; wrong answers are indicated and user may retry until correct.
      - Tracks attempts and wrong counts, then asks the user to pick Best Man or Groomsman.
    */

    // Utility: read URL query parameter with default
    function getQueryParam(key, defaultValue) {
      const params = new URLSearchParams(window.location.search);
      const value = params.get(key);
      return value ? decodeURIComponent(value) : defaultValue;
    }

    // Personalization
    const guestName = getQueryParam("name", "my friend");
    const guestRoleRaw = getQueryParam("role", "Groomsman");
    const isBestManParam = guestRoleRaw.toLowerCase().includes("best");
    // Final role is fixed by guest name: Marco Guarente and Diego Sabal are Best Men
    const finalRole = (guestName === "Marco Guarente" || guestName === "Diego Sabal") ? "Best Man" : "Groomsman";

    // DOM refs
    const roleLabel = document.getElementById("roleLabel");
    const introTitle = document.getElementById("introTitle");
    const introBody = document.getElementById("introBody");
    const hudQuestion = document.getElementById("hudQuestion");
    const hudScore = document.getElementById("hudScore");
    const questionTag = document.getElementById("questionTag");
    const questionTitle = document.getElementById("questionTitle");
    const questionBody = document.getElementById("questionBody");
    const optionsContainer = document.getElementById("optionsContainer");
    const questionHint = document.getElementById("questionHint");
    const resultTitle = document.getElementById("resultTitle");
    const resultBody = document.getElementById("resultBody");
    const resultScoreText = document.getElementById("resultScoreText");
    const btnYes1 = document.getElementById("btnYes1");
    const btnYes2 = document.getElementById("btnYes2");
    const finalTitle = document.getElementById("finalTitle");
    const finalBody = document.getElementById("finalBody");

    const cardIntro = document.getElementById("cardIntro");
    const cardQuestion = document.getElementById("cardQuestion");
    const cardResult = document.getElementById("cardResult");
    const cardFinal = document.getElementById("cardFinal");

    const btnStart = document.getElementById("btnStart");
    const btnDone = document.getElementById("btnDone");

    // ---------------------- per-person question sets -----------------------
    // Add entries here for friends you want to give custom questions to.
    const namedQuestionSets = {
      "Marco Guarente": [
        {
          title: "Where did we first embarrass ourselves together?",
          body: "The true origin story.",
          options: ["At a party", "In class", "On a terrible road trip"],
          correctIndex: 2
        },
        {
          title: "My go-to late night snack",
          body: "Two words.",
          options: ["Cold pizza", "Sardines", "Ice cream"],
          correctIndex: 0
        },
        {
          title: "Who forgets things more often?",
          body: "You know the answer.",
          options: ["Me", "You", "Depends on the day"],
          correctIndex: 1
        },
        {
          title: "Pre-wedding drink of choice",
          body: "Set the vibe.",
          options: ["Whiskey neat", "Gin & tonic", "A beer"],
          correctIndex: 0
        },
        {
          title: "On the wedding day, punctuality is",
          body: "Pick the right attitude.",
          options: ["Mandatory", "Flexible", "An admirable suggestion"],
          correctIndex: 0
        }
      ],
      "Diego Sabal": [
        {
          title: "How do we usually start a night out?",
          body: "The ritual.",
          options: ["With a plan", "With snacks", "No plan, chaos"],
          correctIndex: 2
        },
        {
          title: "Which song will get us singing?",
          body: "You should know this one.",
          options: ["A classic", "Something sad", "A meme song"],
          correctIndex: 0
        },
        {
          title: "My worst cooking disaster",
          body: "Don't be gentle.",
          options: ["Burnt pasta", "Fire alarm incident", "Salt overload"],
          correctIndex: 1
        },
        {
          title: "Who brings the energy?",
          body: "Honestly.",
          options: ["You", "Me", "The DJ"],
          correctIndex: 0
        },
        {
          title: "On the wedding, what's essential?",
          body: "Practical essentials only.",
          options: ["A speech", "A plan", "Snacks"],
          correctIndex: 1
        }
      ]
    };

    // Default pool (will be shuffled deterministically per guest name)
    const defaultQuestions = [
      {
        title: "How did we actually meet",
        body: "There is the official story, and then the truth.",
        options: ["Through some normal adult thing", "Through a reckless plan", "At a wedding"],
        correctIndex: 1
      },
      {
        title: "First drink I order",
        body: "Know the vibe.",
        options: ["Beer", "Something classic", "A shot of something scary"],
        correctIndex: 1
      },
      {
        title: "Who panics more?",
        body: "Honesty only.",
        options: ["Me", "You", "Depends on the situation"],
        correctIndex: 0
      },
      {
        title: "Default plan when lost",
        body: "We have a type.",
        options: ["Ask for directions", "Keep driving", "Find food and regroup"],
        correctIndex: 2
      },
      {
        title: "Wedding day lateness allowance",
        body: "Set the expectation.",
        options: ["Early", "On time", "A little late with coffee"],
        correctIndex: 0
      }
    ];

    // Simple seeded shuffle (mulberry32)
    function hashStringToSeed(str) {
      let h = 2166136261 >>> 0;
      for (let i = 0; i < str.length; i++) {
        h ^= str.charCodeAt(i);
        h = Math.imul(h, 16777619) >>> 0;
      }
      return h;
    }

    function mulberry32(a) {
      return function() {
        a |= 0; a = a + 0x6D2B79F5 | 0;
        let t = Math.imul(a ^ a >>> 15, 1 | a);
        t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t;
        return ((t ^ t >>> 14) >>> 0) / 4294967296;
      };
    }

    function seededShuffle(arr, seed) {
      const rnd = mulberry32(seed);
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(rnd() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function getQuestionsForName(name) {
      const key = (name || "").trim();
      if (namedQuestionSets[key]) {
        return namedQuestionSets[key];
      }
      const seed = hashStringToSeed(key || "default-seed");
      return seededShuffle(defaultQuestions, seed);
    }

    // Choose questions for this guest (always 5 questions expected)
    let questions = getQuestionsForName(guestName);
    // Ensure exactly 5 items (trim or pad with defaultQuestions)
    if (questions.length > 5) questions = questions.slice(0, 5);
    if (questions.length < 5) {
      const extra = defaultQuestions.slice(0, 5 - questions.length);
      questions = questions.concat(extra);
    }

    // State
    let currentIndex = 0;
    let score = 0;
    let wrongCount = 0;
    const attemptsPerQuestion = new Array(questions.length).fill(0);
    let chosenRole = null; // Final role chosen by user

    // Helpers to show/hide cards
    function showCard(card) {
      [cardIntro, cardQuestion, cardResult, cardFinal].forEach(c => c.classList.remove('active'));
      card.classList.add('active');
    }

    function updateHud() {
      hudQuestion.textContent = `${Math.min(currentIndex + 1, questions.length)} / ${questions.length}`;
      hudScore.textContent = String(score);
    }

    // Render a question and wire up answer buttons
    function renderQuestion() {
      const q = questions[currentIndex];
      questionTag.textContent = `Question ${currentIndex + 1}`;
      questionTitle.textContent = q.title;
      questionBody.textContent = q.body;

      optionsContainer.innerHTML = '';

      q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.type = 'button';
        const label = document.createElement('span');
        label.className = 'label';
        label.textContent = opt;
        const key = document.createElement('span');
        key.className = 'key';
        key.textContent = String(idx + 1);
        btn.appendChild(label);
        btn.appendChild(key);

        btn.addEventListener('click', () => handleAnswer(btn, idx));
        optionsContainer.appendChild(btn);
      });

      questionHint.textContent = (currentIndex === questions.length - 1)
        ? 'Last one. Answer carefully (you get one attempt).' 
        : 'Answer honestly. You get one attempt per question; the correct answer will show after.';

      updateHud();
    }

    // Handle an answer: single attempt per question. Show feedback (what they chose and correct answer), then advance.
    function handleAnswer(buttonEl, selectedIdx) {
      const q = questions[currentIndex];
      if (buttonEl.disabled) return;

      // disable all options to lock the choice
      Array.from(optionsContainer.children).forEach(b => b.disabled = true);

      attemptsPerQuestion[currentIndex] += 1;

      const chosenText = q.options[selectedIdx];
      const correctText = q.options[q.correctIndex];

      if (selectedIdx === q.correctIndex) {
        buttonEl.classList.add('correct');
        score += 1;
      } else {
        buttonEl.classList.add('wrong');
        wrongCount += 1;
        // also highlight the correct one
        const children = Array.from(optionsContainer.children);
        const correctBtn = children[q.correctIndex];
        if (correctBtn) correctBtn.classList.add('correct');
      }

      // show explicit feedback showing what they chose and the correct answer
      questionHint.textContent = `You answered: "${chosenText}" ‚Äî Correct: "${correctText}"`;
      updateHud();

      // advance after a short pause so they can read the feedback
      setTimeout(() => {
        if (currentIndex + 1 < questions.length) {
          currentIndex += 1;
          renderQuestion();
        } else {
          showResult();
        }
      }, 1400);
    }

    // Show results with counts and present final role choice buttons
    function showResult() {
      const total = questions.length;
      resultScoreText.textContent = `${score} / ${total}`;

      let titleText, bodyText;
      if (score >= total - 1) {
        titleText = 'Certified legendary';
        bodyText = `${guestName}, you nailed it with ${score}/${total}. You're obviously main-squad material.`;
      } else if (score >= Math.floor(total / 2)) {
        titleText = 'You passed, barely';
        bodyText = `${guestName}, ${score}/${total}. Solid, slightly suspicious, but accepted.`;
      } else {
        titleText = 'Very suspicious, but still in';
        bodyText = `${guestName}, only ${score}/${total}. Still chosen ‚Äî this is personal.`;
      }

      // summary includes wrong count
      resultTitle.textContent = titleText;
      resultBody.textContent = bodyText + ` You had ${wrongCount} incorrect attempt(s).`;

      // set up final choice buttons: both confirm the fixed role (derived from name)
      btnYes1.querySelector('span.label')?.remove?.();
      btnYes2.querySelector('span.label')?.remove?.();
      // Button 1: accept with correct fixed role
      btnYes1.innerHTML = finalRole === 'Best Man'
        ? '<span class="icon">üëë</span><span>Be my Best Man</span>'
        : '<span class="icon">ü§ù</span><span>Be my Groomsman</span>';
      // Button 2: funny resigned accept (same result)
      btnYes2.innerHTML = '<span class="icon">üî•</span><span>F*** it, I accept. I have no choice.</span>';

      // Both buttons confirm the same fixed role
      btnYes1.onclick = () => chooseFinalRole(finalRole);
      btnYes2.onclick = () => chooseFinalRole(finalRole);

      showCard(cardResult);
    }

    // Final selection handler
    function chooseFinalRole(role) {
      chosenRole = role;
      // Final card must clearly state the fixed role and use a short warm message
      if (role === 'Best Man') {
        finalTitle.textContent = 'You are my Best Man';
        finalBody.textContent = `${guestName}, you are officially my Best Man. Screenshot this and text me so we can plan the chaos.`;
      } else {
        finalTitle.textContent = 'You are my Groomsman';
        finalBody.textContent = `${guestName}, you are officially my Groomsman. Screenshot this and text me so we can plan the chaos.`;
      }
      showCard(cardFinal);
    }

    // Attempt to close the tab/window when they click Done
    function finalizeAndClose() {
      // Best effort: browsers usually only allow window.close() on windows opened via script.
      try { window.close(); } catch (e) { /* ignore */ }
      // Fallback: show a small notice (we keep the final card visible)
      finalBody.textContent += ' If this tab did not close automatically, you can safely close it now.';
    }

    // Initialization and bindings
    function initPersonalization() {
      roleLabel.textContent = isBestManParam ? 'Best Man Invite' : 'Groomsman Invite';
      introTitle.textContent = `Welcome, ${guestName}`;
      introBody.innerHTML = `This is your <strong>${isBestManParam ? 'Best Man' : 'Groomsman'} Qualification Test</strong>.<br><br>Answer honestly. Wrong picks let you retry until you get it right.`;
    }

    btnStart.addEventListener('click', () => {
      currentIndex = 0; score = 0; wrongCount = 0; attemptsPerQuestion.fill(0);
      renderQuestion(); showCard(cardQuestion);
    });

    btnDone.addEventListener('click', finalizeAndClose);

    // kickoff
    initPersonalization(); updateHud();
  </script>
</body>
</html>
