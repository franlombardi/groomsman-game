<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Misi√≥n Lisboa 2026</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
  :root {
    /* Light wedding palette */
    --bg-page: #3f5e42;         /* page background, light cream */
    --card-bg: #ffffff;         /* main card background */
    --card-border: #e2d7c9;     /* soft beige border */

    --text-main: #2f3b32;       /* main dark text */
    --text-muted: #7b8577;      /* soft muted text */

    --accent: #3f5e42;          /* deep olive, like RSVP button */
    --accent-soft: #6f8b73;     /* softer olive */
    --danger: #c0564a;
    --good: #3f5e42;

    --radius-xl: 20px;
    --radius-lg: 10px;
    --shadow-soft: 0 14px 30px rgba(15, 23, 42, 0.08);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    min-height: 100vh;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: var(--bg-page);
    color: var(--text-main);
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
  }

  .app {
    width: 100%;
    max-width: 430px;
    background: var(--card-bg);
    border-radius: 24px;
    border: 1px solid var(--card-border);
    box-shadow: var(--shadow-soft);
    padding: 18px 18px 20px;
    position: relative;
    overflow: hidden;
  }

  .app::before {
    content: "";
    position: absolute;
    inset: 0;
    background:
      radial-gradient(circle at top left, rgba(255, 255, 255, 0.65), transparent 55%),
      radial-gradient(circle at bottom right, rgba(222, 209, 193, 0.7), transparent 60%);
    pointer-events: none;
    z-index: -1;
  }

  header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }

  .title-block {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .subtitle {
    font-size: 0.68rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--accent-soft);
  }

  h1 {
    font-family: "Georgia", "Times New Roman", serif;
    font-size: 1.3rem;
    letter-spacing: 0.04em;
    font-weight: 600;
    color: var(--text-main);
  }

  .badge {
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(242, 237, 229, 0.9);
    border: 1px solid var(--card-border);
    font-size: 0.7rem;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    color: var(--text-muted);
  }

  .badge span.icon {
    font-size: 1rem;
  }

  .hud {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  .hud-pill {
    padding: 3px 10px;
    border-radius: 999px;
    background: #f4ece3;
    border: 1px solid var(--card-border);
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }

  .hud-pill span.value {
    font-weight: 600;
    color: var(--accent-soft);
  }

  .hud-pill.good span.value {
    color: var(--good);
  }

  .hud-pill.bad span.value {
    color: var(--danger);
  }

  .hint {
    font-size: 0.7rem;
    color: var(--text-muted);
    margin-bottom: 10px;
  }

  .card {
    border-radius: var(--radius-xl);
    background: var(--card-bg);
    border: 1px solid var(--card-border);
    padding: 16px 16px 14px;
    min-height: 260px;
    display: none;
    flex-direction: column;
    justify-content: space-between;
  }

  .card.active {
    display: flex;
  }

  .card-header-tag {
    font-size: 0.68rem;
    letter-spacing: 0.16em;
    text-transform: uppercase;
    color: var(--accent-soft);
    margin-bottom: 6px;
  }

  .card-title {
    font-size: 1.05rem;
    font-weight: 600;
    margin-bottom: 6px;
    color: var(--text-main);
  }

  .card-body {
    font-size: 0.8rem;
    color: var(--text-muted);
    line-height: 1.5;
  }

  .card-body strong {
    color: var(--accent-soft);
    font-weight: 600;
  }

  .options {
    margin-top: 14px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .option-btn {
    width: 100%;
    padding: 11px 12px;
    border-radius: 8px;
    border: 1px solid var(--card-border);
    background: #f6f0e8;
    color: var(--text-main);
    font-size: 0.8rem;
    text-align: left;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(15, 23, 42, 0.05);
    transition:
      transform 0.06s ease,
      box-shadow 0.06s ease,
      border-color 0.06s ease,
      background 0.06s ease;
  }

  .option-btn span.label {
    flex: 1;
  }

  .option-btn span.key {
    font-size: 0.7rem;
    color: var(--text-muted);
  }

  .option-btn:active {
    transform: translateY(1px);
    box-shadow: 0 4px 8px rgba(15, 23, 42, 0.08);
    border-color: var(--accent-soft);
  }

  /* visual feedback for answers */
  .option-btn.correct {
    border-color: var(--good);
    background: #e4f0e6;
    box-shadow: 0 6px 14px rgba(63, 94, 66, 0.12);
  }

  .option-btn.wrong {
    border-color: var(--danger);
    background: #fce9e7;
    opacity: 0.98;
  }

  .btn-row {
    margin-top: 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .btn {
    border: none;
    border-radius: 6px;
    padding: 11px 10px;
    font-size: 0.8rem;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 8px 16px rgba(63, 94, 66, 0.25);
    transition: transform 0.06s ease, box-shadow 0.06s ease, background 0.06s ease;
  }

  .btn-primary {
    background: var(--accent);
    color: #f7f4ee;
  }

  .btn-primary:active {
    transform: translateY(1px);
    box-shadow: 0 4px 10px rgba(63, 94, 66, 0.35);
  }

  .btn-secondary {
    background: transparent;
    color: var(--accent);
    border: 1px solid var(--accent);
    box-shadow: none;
  }

  .btn-secondary:active {
    transform: translateY(1px);
    box-shadow: 0 3px 8px rgba(63, 94, 66, 0.25);
  }

  .btn span.icon {
    font-size: 1rem;
  }

  .small-text {
    margin-top: 6px;
    font-size: 0.68rem;
    color: var(--text-muted);
  }

  .small-text strong {
    color: var(--accent-soft);
  }

  .score-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 3px 8px;
    border-radius: 999px;
    background: #f4ece3;
    border: 1px solid var(--card-border);
    font-size: 0.68rem;
    color: var(--text-muted);
  }

  .score-pill span.value {
    color: var(--good);
    font-weight: 600;
  }

  footer {
    margin-top: 8px;
    text-align: center;
    font-size: 0.64rem;
    color: var(--text-muted);
  }

  footer strong {
    color: var(--accent-soft);
  }

  .final-photo {
    width: 100%;
    max-width: 280px;
    margin: 16px auto 0;
    border-radius: 12px;
    display: block;
    box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
  }

  @media (max-width: 380px) {
    .app {
      border-radius: 20px;
      padding: 14px;
    }

    .card {
      border-radius: 16px;
      padding: 14px;
    }
  }
</style>

</head>
<body>
  <div class="app">
    <header>
      <div class="title-block">
        <span class="subtitle">Mini misi√≥n</span>
        <h1>Misi√≥n Lisboa 2026</h1>
      </div>
      <div class="badge">
        <span class="icon">ü§µ‚Äç‚ôÇÔ∏è</span>
        <span id="roleLabel">Wedding Squad</span>
      </div>
    </header>

    <div class="hud">
      <div class="hud-pill">
        <span>Question</span>
        <span class="value" id="hudQuestion">0 / 0</span>
      </div>
      <div class="hud-pill good">
        <span>Score</span>
        <span class="value" id="hudScore">0</span>
      </div>
    </div>

    <div class="hint">
      Todo lo que tienes que hacer es tocar la opci√≥n que te parezca m√°s correcta. Sin ayuda, solo instinto.
    </div>

    <!-- Intro card -->
    <div id="cardIntro" class="card active">
      <div>
        <div class="card-header-tag">Briefing</div>
        <div class="card-title" id="introTitle">Welcome, my friend</div>
        <div class="card-body" id="introBody">
          This is your <strong>Best Man Qualification Test</strong>, also known as the Worst Man stress test.<br /><br />
          You will get a few quick questions about our chaos and my life choices. There is no official pass mark,
          but I will absolutely judge you silently.
        </div>
      </div>
      <div>
        <div class="btn-row">
          <button id="btnStart" class="btn btn-primary">
            <span class="icon">‚ñ∂Ô∏è</span>
            <span>Comenzar</span>
          </button>
        </div>
        <div class="small-text">
          Hazle screenshot al resultado cuando termines.
        </div>
      </div>
    </div>

    <!-- Question card -->
    <div id="cardQuestion" class="card">
      <div>
        <div class="card-header-tag" id="questionTag">Pregunta</div>
        <div class="card-title" id="questionTitle">Pregunta</div>
        <div class="card-body" id="questionBody">
          Escoge la opci√≥n que te parezca m√°s correcta. Solo hay una respuesta oficial, pero los vibes importan.
        </div>
        <div class="options" id="optionsContainer">
          <!-- buttons inserted here by JS -->
        </div>
      </div>
      <div class="small-text" id="questionHint">
        Consejo: responde bas√°ndote en lo que sabes de m√≠, no en lo que crees que es la respuesta educada.
      </div>
    </div>

    <!-- Result card -->
    <div id="cardResult" class="card">
      <div>
        <div class="card-header-tag">Resultados</div>
        <div class="card-title" id="resultTitle">Sobreviviste a la prueba</div>
        <div class="card-body" id="resultBody">
          Texto de resultado.
        </div>
      </div>
      <div>
        <div class="btn-row">
          <button id="btnYes1" class="btn btn-primary">
            <span class="icon">‚úÖ</span>
            <span id="btnYes1Text">Yes, obviously</span>
          </button>
          <button id="btnYes2" class="btn btn-secondary">
            <span class="icon">üî•</span>
            <span id="btnYes2Text">I was born for this</span>
          </button>
        </div>
        <div class="small-text">
          <span class="score-pill">
            <span>Test score</span>
            <span class="value" id="resultScoreText">0 / 0</span>
          </span>
        </div>
      </div>
    </div>

    <!-- Final answer card -->
    <div id="cardFinal" class="card">
      <div>
        <div class="card-header-tag">Squad locked</div>
        <div class="card-title" id="finalTitle">You are in</div>
        <div class="card-body" id="finalBody">
          Screenshot this if you want proof, then text me so we can plan the chaos properly.
        </div>
      </div>
      <div>
        <div class="btn-row">
          <button id="btnDone" class="btn btn-primary">
            <span class="icon">üì≤</span>
            <span>Listo</span>
          </button>
        </div>
        <div class="small-text">
          Puedes cerrar esta pesta√±a, pero la responsabilidad ahora es permanente.
        </div>
      </div>
    </div>

    <footer>
      Designed as a one time invite for the <strong>wedding squad</strong>.
    </footer>
  </div>

  <script>
    /*
      Structure: Single-file SPA with four cards (Intro, Question, Result, Final).
      - Reads `id` from URL params and looks up the person's config.
      - Each person has their own name, role, questions, and final image.
      - Shows questions one at a time; single attempt per question with feedback.
      - Tracks attempts and wrong counts, then shows the final card with the person's image.
    */

    // Utility: read URL query parameter with default
    function getQueryParam(key, defaultValue) {
      const params = new URLSearchParams(window.location.search);
      const value = params.get(key);
      return value ? decodeURIComponent(value) : defaultValue;
    }

    // ==================== Per-person configuration ====================
    // Each person config: name, role, finalImage path, and their 5 questions.
    const peopleConfig = {
      diego: {
        fullName: "Diego Sabal",
        nickname: "Dieguishhh",
        role: "Best Man",
        finalImage: "images/diego-final.jpg",
        questions: [
          {
            title: "How do we usually start a night out?",
            body: "The ritual.",
            options: ["With a plan", "With snacks", "No plan, chaos"],
            correctIndex: 2
          },
          {
            title: "Which song will get us singing?",
            body: "You should know this one.",
            options: ["A classic", "Something sad", "A meme song"],
            correctIndex: 0
          },
          {
            title: "My worst cooking disaster",
            body: "Don't be gentle.",
            options: ["Burnt pasta", "Fire alarm incident", "Salt overload"],
            correctIndex: 1
          },
          {
            title: "Who brings the energy?",
            body: "Honestly.",
            options: ["You", "Me", "The DJ"],
            correctIndex: 0
          },
          {
            title: "On the wedding, what's essential?",
            body: "Practical essentials only.",
            options: ["A speech", "A plan", "Snacks"],
            correctIndex: 1
          }
        ]
      },
      marco: {
        fullName: "Marco Guarente",
        nickname: "Marcookie",
        role: "Best Man",
        finalImage: "images/marco-final.jpg",
        questions: [
          {
            title: "Where did we first embarrass ourselves together?",
            body: "The true origin story.",
            options: ["At a party", "In class", "On a terrible road trip"],
            correctIndex: 2
          },
          {
            title: "My go-to late night snack",
            body: "Two words.",
            options: ["Cold pizza", "Sardines", "Ice cream"],
            correctIndex: 0
          },
          {
            title: "Who forgets things more often?",
            body: "You know the answer.",
            options: ["Me", "You", "Depends on the day"],
            correctIndex: 1
          },
          {
            title: "Pre-wedding drink of choice",
            body: "Set the vibe.",
            options: ["Whiskey neat", "Gin & tonic", "A beer"],
            correctIndex: 0
          },
          {
            title: "On the wedding day, punctuality is",
            body: "Pick the right attitude.",
            options: ["Mandatory", "Flexible", "An admirable suggestion"],
            correctIndex: 0
          }
        ]
      },
      gabriel: {
        fullName: "Gabriel Sosa",
        nickname: "Gaibiri",
        role: "Groomsman",
        finalImage: "images/gabriel-final.jpg",
        questions: [
          {
            title: "How did we first meet?",
            body: "The origin story.",
            options: ["At a party", "Through a friend", "At work"],
            correctIndex: 1
          },
          {
            title: "My first go-to drink",
            body: "Know me well.",
            options: ["Beer", "Whiskey", "Wine"],
            correctIndex: 0
          },
          {
            title: "Who is more spontaneous?",
            body: "Honesty.",
            options: ["You", "Me", "It depends"],
            correctIndex: 0
          },
          {
            title: "Perfect night out looks like",
            body: "What's our style?",
            options: ["Dinner and drinks", "Chaos and laughs", "Low key hangout"],
            correctIndex: 1
          },
          {
            title: "Wedding day energy",
            body: "Set the tone.",
            options: ["Calm and cool", "Hyped up", "Just go with it"],
            correctIndex: 2
          }
        ]
      },
      guillermo: {
        fullName: "Guillermo Stalhuth",
        nickname: "Guille",
        role: "Groomsman",
        finalImage: "images/guillermo-final.jpg",
        questions: [
          {
            title: "How would you describe our friendship?",
            body: "Real answer.",
            options: ["Just met", "Old friends", "Brothers"],
            correctIndex: 2
          },
          {
            title: "My favorite weekend activity",
            body: "Think about it.",
            options: ["Sports", "Hiking", "Hanging with friends"],
            correctIndex: 2
          },
          {
            title: "When I'm stressed, I",
            body: "Real talk.",
            options: ["Talk it out", "Work it out physically", "Take time alone"],
            correctIndex: 1
          },
          {
            title: "Best advice you'd give me",
            body: "No pressure.",
            options: ["Work hard", "Live in the moment", "Stay humble"],
            correctIndex: 2
          },
          {
            title: "What role are you perfect for?",
            body: "Final check.",
            options: ["Best man", "Groomsman", "Both equally"],
            correctIndex: 1
          }
        ]
      },
      andres: {
        fullName: "Andres Sabal",
        nickname: "Andres",
        role: "Groomsman",
        finalImage: "images/andres-final.jpg",
        questions: [
          {
            title: "Our shared memories are mostly",
            body: "Think back.",
            options: ["Fun and crazy", "Thoughtful and deep", "Both"],
            correctIndex: 0
          },
          {
            title: "You'd describe me as",
            body: "Be honest.",
            options: ["The planner", "The wild one", "The listener"],
            correctIndex: 1
          },
          {
            title: "Best time we've had together",
            body: "Favorite moment.",
            options: ["On a trip", "Just hanging out", "At a big event"],
            correctIndex: 0
          },
          {
            title: "What I value most in friends",
            body: "Core value.",
            options: ["Loyalty", "Fun", "Honesty"],
            correctIndex: 0
          },
          {
            title: "Why should you be my groomsman?",
            body: "Final answer.",
            options: ["You know me best", "You'll have fun", "You're reliable"],
            correctIndex: 2
          }
        ]
      },
      daniel: {
        fullName: "Daniel Najul",
        nickname: "Daaaaaani",
        role: "Groomsman",
        finalImage: "images/daniel-final.jpg",
        questions: [
          {
            title: "How long have we known each other?",
            body: "Time check.",
            options: ["A few years", "Many years", "Since childhood"],
            correctIndex: 1
          },
          {
            title: "My personality in one word",
            body: "Quick assessment.",
            options: ["Energetic", "Chill", "Thoughtful"],
            correctIndex: 2
          },
          {
            title: "Best way to celebrate is",
            body: "My style.",
            options: ["Big party", "Intimate dinner", "Adventure"],
            correctIndex: 0
          },
          {
            title: "What keeps our friendship strong",
            body: "Real foundation.",
            options: ["Common interests", "Genuine care", "Fun times"],
            correctIndex: 1
          },
          {
            title: "You're excited to be my groomsman because",
            body: "Final thought.",
            options: ["It's an honor", "It'll be fun", "Both"],
            correctIndex: 2
          }
        ]
      }
    };

    // Read person id from URL
    const personId = getQueryParam("id", null);
    let person = null;
    
    if (personId && peopleConfig[personId]) {
      person = peopleConfig[personId];
    }

    // Personalization: derived from person config
    const guestName = person ? person.fullName : "my friend";
    const finalRole = person ? person.role : "Groomsman";
    const isBestManParam = finalRole === "Best Man";

    // DOM refs
    const roleLabel = document.getElementById("roleLabel");
    const introTitle = document.getElementById("introTitle");
    const introBody = document.getElementById("introBody");
    const hudQuestion = document.getElementById("hudQuestion");
    const hudScore = document.getElementById("hudScore");
    const questionTag = document.getElementById("questionTag");
    const questionTitle = document.getElementById("questionTitle");
    const questionBody = document.getElementById("questionBody");
    const optionsContainer = document.getElementById("optionsContainer");
    const questionHint = document.getElementById("questionHint");
    const resultTitle = document.getElementById("resultTitle");
    const resultBody = document.getElementById("resultBody");
    const resultScoreText = document.getElementById("resultScoreText");
    const btnYes1 = document.getElementById("btnYes1");
    const btnYes2 = document.getElementById("btnYes2");
    const finalTitle = document.getElementById("finalTitle");
    const finalBody = document.getElementById("finalBody");

    const cardIntro = document.getElementById("cardIntro");
    const cardQuestion = document.getElementById("cardQuestion");
    const cardResult = document.getElementById("cardResult");
    const cardFinal = document.getElementById("cardFinal");

    const btnStart = document.getElementById("btnStart");
    const btnDone = document.getElementById("btnDone");

    // Get questions from person config
    const questions = person ? person.questions : [];

    // State
    let currentIndex = 0;
    let score = 0;
    let wrongCount = 0;
    const attemptsPerQuestion = new Array(questions.length).fill(0);
    let chosenRole = null; // Final role chosen by user

    // Helpers to show/hide cards
    function showCard(card) {
      [cardIntro, cardQuestion, cardResult, cardFinal].forEach(c => c.classList.remove('active'));
      card.classList.add('active');
    }

    function updateHud() {
      hudQuestion.textContent = `${Math.min(currentIndex + 1, questions.length)} / ${questions.length}`;
      hudScore.textContent = String(score);
    }

    // Render a question and wire up answer buttons
    function renderQuestion() {
      const q = questions[currentIndex];
      questionTag.textContent = `Pregunta ${currentIndex + 1}`;
      questionTitle.textContent = q.title;
      questionBody.textContent = q.body;

      optionsContainer.innerHTML = '';

      q.options.forEach((opt, idx) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.type = 'button';
        const label = document.createElement('span');
        label.className = 'label';
        label.textContent = opt;
        const key = document.createElement('span');
        key.className = 'key';
        key.textContent = String(idx + 1);
        btn.appendChild(label);
        btn.appendChild(key);

        btn.addEventListener('click', () => handleAnswer(btn, idx));
        optionsContainer.appendChild(btn);
      });

      questionHint.textContent = (currentIndex === questions.length - 1)
        ? 'La √∫ltima. Responde con cuidado (tienes un intento).' 
        : 'Responde honestamente. Tienes un intento por pregunta; la respuesta correcta aparecer√° despu√©s.';

      updateHud();
    }

    // Handle an answer: single attempt per question. Show feedback (what they chose and correct answer), then advance.
    function handleAnswer(buttonEl, selectedIdx) {
      const q = questions[currentIndex];
      if (buttonEl.disabled) return;

      // disable all options to lock the choice
      Array.from(optionsContainer.children).forEach(b => b.disabled = true);

      attemptsPerQuestion[currentIndex] += 1;

      const chosenText = q.options[selectedIdx];
      const correctText = q.options[q.correctIndex];

      if (selectedIdx === q.correctIndex) {
        buttonEl.classList.add('correct');
        score += 1;
      } else {
        buttonEl.classList.add('wrong');
        wrongCount += 1;
        // also highlight the correct one
        const children = Array.from(optionsContainer.children);
        const correctBtn = children[q.correctIndex];
        if (correctBtn) correctBtn.classList.add('correct');
      }

      // show explicit feedback showing what they chose and the correct answer
      questionHint.textContent = `Respondiste: "${chosenText}" ‚Äî Correcto: "${correctText}"`;
      updateHud();

      // advance after a short pause so they can read the feedback
      setTimeout(() => {
        if (currentIndex + 1 < questions.length) {
          currentIndex += 1;
          renderQuestion();
        } else {
          showResult();
        }
      }, 1400);
    }

    // Show results with counts and present final role choice buttons
    function showResult() {
      const total = questions.length;
      resultScoreText.textContent = `${score} / ${total}`;

      let titleText, bodyText;
      if (score >= total - 1) {
        titleText = 'Eres leyenda certificada';
        bodyText = `${guestName}, lo hiciste perfecto con ${score}/${total}. Claramente eres material de primera l√≠nea.`;
      } else if (score >= Math.floor(total / 2)) {
        titleText = 'Pasaste, apenas';
        bodyText = `${guestName}, ${score}/${total}. S√≥lido, un poco sospechoso, pero aceptado.`;
      } else {
        titleText = 'Muy sospechoso, pero a√∫n est√°s dentro';
        bodyText = `${guestName}, solo ${score}/${total}. A√∫n as√≠ elegido ‚Äî esto es personal.`;
      }

      // summary includes wrong count
      resultTitle.textContent = titleText;
      resultBody.textContent = bodyText + ` Tuviste ${wrongCount} intento(s) incorrecto(s).`;

      // set up final choice buttons: both confirm the fixed role (derived from name)
      btnYes1.querySelector('span.label')?.remove?.();
      btnYes2.querySelector('span.label')?.remove?.();
      // Button 1: accept with correct fixed role
      btnYes1.innerHTML = finalRole === 'Best Man'
        ? '<span class="icon">üëë</span><span>Ser tu Best Man</span>'
        : '<span class="icon">ü§ù</span><span>Ser tu Groomsman</span>';
      // Button 2: funny resigned accept (same result)
      btnYes2.innerHTML = '<span class="icon">üî•</span><span>Est√° bien, acepto. No tengo opci√≥n.</span>';

      // Both buttons confirm the same fixed role
      btnYes1.onclick = () => chooseFinalRole(finalRole);
      btnYes2.onclick = () => chooseFinalRole(finalRole);

      showCard(cardResult);
    }

    // Final selection handler
    function chooseFinalRole(role) {
      chosenRole = role;
      // Final card must clearly state the fixed role and use a short warm message
      if (role === 'Best Man') {
        finalTitle.textContent = 'Eres mi Best Man';
        finalBody.textContent = `${guestName}, oficialmente eres mi Best Man. Toma captura de pantalla y m√°ndame un mensaje para que podamos planificar el caos.`;
      } else {
        finalTitle.textContent = 'Eres mi Groomsman';
        finalBody.textContent = `${guestName}, oficialmente eres mi Groomsman. Toma captura de pantalla y m√°ndame un mensaje para que podamos planificar el caos.`;
      }
      
      // Add the final photo if person config exists
      const existingImg = cardFinal.querySelector('.final-photo');
      if (existingImg) existingImg.remove();
      
      if (person && person.finalImage) {
        const img = document.createElement('img');
        img.className = 'final-photo';
        img.src = person.finalImage;
        img.alt = `${guestName}'s photo`;
        cardFinal.querySelector('.card-body')?.appendChild(img) || cardFinal.appendChild(img);
      }
      
      showCard(cardFinal);
    }

    // Attempt to close the tab/window when they click Done
    function finalizeAndClose() {
      // Best effort: browsers usually only allow window.close() on windows opened via script.
      try { window.close(); } catch (e) { /* ignore */ }
      // Fallback: show a small notice (we keep the final card visible)
      finalBody.textContent += ' Si la pesta√±a no se cierra, puedes cerrarla manualmente.';
    }

    // Initialization and bindings
    function initPersonalization() {
      if (person) {
        roleLabel.textContent = person.role === 'Best Man' ? 'Boda 2026' : 'Boda 2026';
        introTitle.textContent = `${person.nickname}, necesito que pases esta mini misi√≥n.`;
        introBody.innerHTML = `Esto es una mini misi√≥n para la boda en Lisboa, el 20 de septiembre de 2026.<br><br>Son pocas preguntas r√°pidas sobre nosotros y sobre c√≥mo ves todo este desastre organizado. No hay nota m√≠nima oficial, pero s√≠ voy a estar pendiente de tus respuestas.`;
      } else {
        roleLabel.textContent = 'Enlace Inv√°lido';
        introTitle.textContent = '¬°Oops!';
        introBody.innerHTML = '<strong>Este enlace no est√° configurado.</strong><br><br>Escr√≠beme para pedir el link correcto.';
        btnStart.disabled = true;
        btnStart.textContent = 'Enlace Inv√°lido';
      }
    }

    btnStart.addEventListener('click', () => {
      if (person && questions.length > 0) {
        currentIndex = 0; score = 0; wrongCount = 0; attemptsPerQuestion.fill(0);
        renderQuestion(); showCard(cardQuestion);
      }
    });

    btnDone.addEventListener('click', finalizeAndClose);

    // kickoff
    initPersonalization(); updateHud();
  </script>
</body>
</html>
